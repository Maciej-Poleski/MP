\documentclass[a4paper,12pt]{article}
%\documentclass[a4paper,12pt]{scrartcl}

\usepackage[utf8x]{inputenc}
\usepackage{polski}

\title{Zadania domowe. Blok 4. Zestaw 1}
\author{Maciej Poleski}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{alltt}
\usepackage{listings}

\date{\today}

\pdfinfo{%
  /Title    (Zadania domowe. Blok 4. Zestaw 1)
  /Author   (Maciej Poleski)
  /Creator  (Maciej Poleski)
  /Producer (Maciej Poleski)
  /Subject  (MP)
  /Keywords (MP)
}

\begin{document}
\maketitle

\newpage

\section{Najbliżsi}
Drzewo licznikowe jak w zadaniu R.
\begin{alltt}
static uint32_t nextpow2(uint32_t v)
{
    uint32_t r = 1;
    while(r < v)
        r *= 2;
    return r;
}

class SumTree
{
public:
    SumTree(std::size_t size) :
        _size(nextpow2(size)), _tree(new int[_size * 2]) {}

    ~SumTree() {
        delete [] _tree;
    }
    
    void update(int ix, int value);
    int difference(int ix, int k);

private:
    int sum(uint32_t a, uint32_t b);
    int value(uint32_t index) {
        return _tree[index + _size];
    }
    uint32_t size() const {
        return _size;
    }

private:
    std::size_t _size;
    int *_tree;
};

void SumTree::update(int index, int v)
{
    int diff=v-_tree[_size+index];
    for(size_t i = index + _size; i > 0; i /= 2) {
        _tree[i].value += diff;
    }
}

int SumTree::sum(uint32_t a, uint32_t b)
{
    if(a == 0 && b == _size - 1)
        return _tree[1];
    uint_fast32_t left = a + _size;
    uint_fast32_t right = b + _size;
    int result = 0;
    uint_fast8_t height = 0;
    uint_fast32_t i = left;
    while(true) {
        if(left > right)
            break;
        while((i << height) < left || (((i + 1) << height) - 1) > right) {
            i *= 2;
            --height;
        }
        while((((i / 2) << (height + 1)) >= left) &&
                (((i / 2 + 1) << (height + 1)) - 1 <= right)) {
            i /= 2;
            ++height;
        }
        result += _tree[i];
        left = (i + 1) << height;
        ++i;
    }
    return result;
}
\end{alltt}
\verb|T| jest typem elementów w tablicy wejściowej. Wynikiem jest tablica (nieposortowana) zawierająca poszukiwaną odpowiedź.


\end{document}
